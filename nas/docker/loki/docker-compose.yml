services:
  loki:
    image: grafana/loki:latest
    container_name: loki
    restart: unless-stopped
    network_mode: host
    volumes:
      - /share/CACHEDEV1_DATA/docker/loki/loki-config.yml:/etc/loki/local-config.yaml:ro
      - /share/CACHEDEV1_DATA/docker/loki/data:/loki
    command: -config.file=/etc/loki/local-config.yaml
    # Notes:
    # - Host networking for Promtail and Grafana access
    # - Port 3100
    # - 120-day log retention
    # - Data stored on RAID 5

  promtail:
    image: grafana/promtail:latest
    container_name: promtail
    restart: unless-stopped
    network_mode: host
    volumes:
      - /share/CACHEDEV1_DATA/docker/loki/promtail-config.yml:/etc/promtail/config.yml:ro
      - /var/run/system-docker.sock:/var/run/docker.sock:ro
    command: -config.file=/etc/promtail/config.yml
    depends_on:
      - loki
    # Notes:
    # - QNAP uses /var/run/system-docker.sock (mapped to /var/run/docker.sock inside container)
    # - Discovers and ships logs from all NAS Docker containers
    # - Docker service discovery auto-detects new containers
